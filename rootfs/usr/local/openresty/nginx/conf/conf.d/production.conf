# Admin Interface
server {
    set $forward_scheme http;
    set $server "127.0.0.1";
    set $port 48693;
    
    listen 81 ssl http2 default;
    listen 81 http3 default;
    listen [::]:81 ssl http2 default;
    listen [::]:81 http3 default;

    server_name nginxproxymanager;
    ssl_certificate /data/nginx/dummycert.pem;
    ssl_certificate_key /data/nginx/dummykey.pem;
    include conf.d/include/ssl-ciphers.conf;
    include conf.d/include/block-exploits.conf;
    include conf.d/include/letsencrypt-acme-challenge.conf;
    add_header alt-svc 'h3=":443"; ma=86400, h3-29=":443"; ma=86400';

    location /api {
        return 301 /api/;
    }

    location /api/ {
        proxy_read_timeout 15m;
        proxy_send_timeout 15m;
        include conf.d/include/proxy.conf;
        proxy_set_header X-Forwarded-Port 81;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }

    location / {
        root /app/frontend;
        if ($request_uri ~ ^/(.*)\.html$) {
            return 302 /$1;
        }
        try_files $uri $uri.html $uri/ /index.html;
    }
}
