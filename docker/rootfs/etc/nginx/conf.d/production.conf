# Admin Interface
server {
	listen 81 ssl http2 default_server;
	listen 81 http3 default_server;
	listen [::]:81 ssl http2 default_server;
	listen [::]:81 http3 default_server;

        server_name 81.npm;
	root /app/frontend;
	access_log /dev/null;
	ssl_certificate /data/nginx/dummycert.pem;
	ssl_certificate_key /data/nginx/dummykey.pem;
	include conf.d/include/assets.conf;
	include conf.d/include/block-exploits.conf;
	include conf.d/include/force-ssl.conf;
	include conf.d/include/ssl-ciphers.conf;
	include conf.d/include/letsencrypt-acme-challenge.conf;

        add_header alt-svc 'h3=":443"; ma=86400, h3-29=":443"; ma=86400';

	location /api {
                add_header alt-svc 'h3=":443"; ma=86400, h3-29=":443"; ma=86400';
		return 301 /api/;
		include conf.d/include/block-exploits.conf;
	}

	location /api/ {
		add_header            X-Served-By $host;
                add_header alt-svc 'h3=":443"; ma=86400, h3-29=":443"; ma=86400';
		proxy_set_header Host                    $host;
		proxy_set_header      X-Forwarded-Scheme $scheme;
		proxy_set_header      X-Forwarded-Proto  $scheme;
		proxy_set_header      X-Forwarded-For    $remote_addr;
		proxy_pass            http://127.0.0.1:3000/;

		proxy_read_timeout 15m;
		proxy_send_timeout 15m;
		include conf.d/include/block-exploits.conf;
	}

	location / {
		index index.html;
                add_header alt-svc 'h3=":443"; ma=86400, h3-29=":443"; ma=86400';
		if ($request_uri ~ ^/(.*)\.html$) {
			return 302 /$1;
		}
		try_files $uri $uri.html $uri/ /index.html;
		include conf.d/include/block-exploits.conf;
		include conf.d/include/letsencrypt-acme-challenge.conf;
	}
}
